# 出張精算システム フローチャート

本文書では、出張精算システムの機能仕様に基づいたフローチャートをMermaid記法で記載します。

## 1. ユーザー認証フロー

```mermaid
flowchart TD
    A[ログイン画面] --> B{認証情報入力}
    B --> C[メールアドレス・パスワード検証]
    C --> D{認証成功?}
    D -->|Yes| E[JWTトークン生成]
    D -->|No| F[エラーメッセージ表示]
    F --> B
    E --> G{ユーザーロール判定}
    G -->|社員| H[社員ダッシュボード]
    G -->|経理| I[経理ダッシュボード]
    H --> J[セッション開始]
    I --> J
    J --> K[自動ログアウト監視開始]
    K --> L{一定時間操作なし?}
    L -->|Yes| M[自動ログアウト]
    L -->|No| N[セッション継続]
    N --> L
    M --> A
```

## 2. 社員向け精算申請プロセスフロー

```mermaid
flowchart TD
    A[ダッシュボード] --> B[新規申請作成]
    B --> C[申請基本情報入力]
    C --> D[出張目的・期間入力]
    D --> E[精算項目追加]
    E --> F{項目追加継続?}
    F -->|Yes| G[カテゴリー選択]
    F -->|No| H[合計金額自動計算]
    G --> I[金額・説明入力]
    I --> J[領収書アップロード]
    J --> K[項目保存]
    K --> E
    H --> L{保存方法選択}
    L -->|下書き保存| M[下書きとして保存]
    L -->|申請提出| N[入力内容検証]
    M --> O[申請一覧へ]
    N --> P{検証エラー?}
    P -->|Yes| Q[エラー表示・修正]
    P -->|No| R[申請提出]
    Q --> D
    R --> S[提出完了通知]
    S --> T[ステータス: 申請中]
    T --> O
```

## 3. 経理部門承認プロセスフロー

```mermaid
flowchart TD
    A[経理ダッシュボード] --> B[承認待ち一覧]
    B --> C{申請選択}
    C --> D[申請詳細確認]
    D --> E[申請内容審査]
    E --> F[領収書確認]
    F --> G[過去履歴参照]
    G --> H{審査結果判定}
    H -->|承認| I[承認処理]
    H -->|却下| J[却下理由入力]
    I --> K[承認コメント入力（任意）]
    J --> L[却下処理実行]
    K --> M[承認処理実行]
    M --> N[申請者へ承認通知]
    L --> O[申請者へ却下通知]
    N --> P[ステータス: 承認済]
    O --> Q[ステータス: 却下]
    P --> R[支払い処理へ]
    Q --> S[申請者による修正待ち]
    S --> T{再提出あり?}
    T -->|Yes| C
    T -->|No| U[申請終了]
```

## 4. 支払い処理フロー

```mermaid
flowchart TD
    A[承認済申請一覧] --> B[支払い対象選択]
    B --> C[支払い方法選択]
    C --> D{支払い方法}
    D -->|銀行振込| E[振込情報確認]
    D -->|その他| F[支払い詳細入力]
    E --> G[振込処理実行]
    F --> G
    G --> H[支払い完了記録]
    H --> I[支払い証明書添付]
    I --> J[申請者へ支払い完了通知]
    J --> K[ステータス: 支払済]
    K --> L[支払い履歴更新]
    L --> M[処理完了]
```

## 5. 社員向け画面遷移フロー

```mermaid
flowchart TD
    A[ログイン画面] --> B[社員ダッシュボード]
    B --> C[新規申請作成]
    B --> D[申請一覧]
    B --> E[プロフィール設定]
    
    C --> F[申請確認画面]
    F --> G[提出完了画面]
    G --> B
    
    D --> H[申請詳細画面]
    H --> I{申請ステータス}
    I -->|下書き| J[編集画面]
    I -->|却下| K[再提出画面]
    I -->|その他| L[詳細表示のみ]
    
    J --> F
    K --> F
    L --> D
    
    E --> M[プロフィール編集]
    M --> N[パスワード変更]
    M --> B
    N --> B
```

## 6. 経理部門向け画面遷移フロー

```mermaid
flowchart TD
    A[ログイン画面] --> B[経理ダッシュボード]
    B --> C[承認待ち一覧]
    B --> D[全申請管理]
    B --> E[支払い処理]
    B --> F[ユーザー管理]
    B --> G[レポート・分析]
    
    C --> H[申請審査画面]
    H --> I[承認/却下処理]
    I --> C
    
    D --> J[申請詳細確認]
    D --> K[CSV出力]
    J --> D
    K --> D
    
    E --> L[支払い完了登録]
    L --> E
    
    F --> M[新規ユーザー登録]
    F --> N[ユーザー情報編集]
    M --> F
    N --> F
    
    G --> O[各種分析レポート]
    O --> P[PDF/CSV出力]
    P --> G
```

## 7. 例外処理・エラーハンドリングフロー

```mermaid
flowchart TD
    A[システム操作] --> B{エラー発生?}
    B -->|No| C[正常処理継続]
    B -->|Yes| D{エラー種別判定}
    
    D -->|認証エラー| E[ログイン画面へリダイレクト]
    D -->|権限エラー| F[アクセス拒否画面]
    D -->|入力エラー| G[エラーメッセージ表示]
    D -->|サーバーエラー| H[システムエラー画面]
    D -->|ネットワークエラー| I[接続エラー画面]
    
    E --> J[再ログイン]
    F --> K[前画面に戻る]
    G --> L[入力内容修正]
    H --> M[管理者へ通知]
    I --> N[再接続試行]
    
    J --> A
    K --> A
    L --> A
    M --> O[エラーログ記録]
    N --> P{接続回復?}
    
    P -->|Yes| A
    P -->|No| Q[オフラインモード]
    Q --> R[接続復旧待ち]
    R --> A
    
    O --> S[システム復旧対応]
    S --> A
```

## 8. 申請ライフサイクル全体フロー

```mermaid
flowchart TD
    A[申請作成開始] --> B[下書き保存]
    B --> C{編集継続?}
    C -->|Yes| D[申請内容編集]
    C -->|No| E[申請提出]
    D --> B
    E --> F[ステータス: 申請中]
    F --> G[経理部門審査]
    G --> H{審査結果}
    
    H -->|承認| I[ステータス: 承認済]
    H -->|却下| J[ステータス: 却下]
    
    I --> K[支払い処理]
    K --> L[ステータス: 支払済]
    L --> M[申請完了]
    
    J --> N[却下理由通知]
    N --> O{再提出する?}
    O -->|Yes| P[申請内容修正]
    O -->|No| Q[申請取り下げ]
    
    P --> E
    Q --> R[申請終了]
    
    M --> S[データアーカイブ判定]
    S --> T{保持期間経過?}
    T -->|No| U[データ保持継続]
    T -->|Yes| V[アーカイブ処理]
    V --> W[長期保存]
```

## 9. 通知システムフロー

```mermaid
flowchart TD
    A[システムイベント発生] --> B{イベント種別}
    
    B -->|申請提出| C[経理部門へ通知]
    B -->|承認完了| D[申請者へ通知]
    B -->|却下| E[申請者へ通知]
    B -->|支払い完了| F[申請者へ通知]
    B -->|緊急申請| G[経理部門へ優先通知]
    B -->|月次締め| H[経理部門へリマインダー]
    
    C --> I[メール送信]
    D --> I
    E --> J[却下理由付きメール送信]
    F --> I
    G --> K[緊急フラグ付き通知]
    H --> L[締め処理リマインダー]
    
    I --> M[通知履歴記録]
    J --> M
    K --> M
    L --> M
    
    M --> N[通知完了]
```

---

これらのフローチャートは、出張精算システムの機能仕様書に基づいて作成されており、システムの主要な業務プロセスと画面遷移を視覚的に表現しています。各フローは相互に関連し合い、全体として統合されたシステムの動作を示しています。